<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mayada Gallery | Ù„Ù„Ù‡Ø¯Ø§ÙŠØ§ ÙˆØ§Ù„Ø¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª</title>

    <meta name="theme-color" content="#0f172a">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="https://images.pexels.com/photos/264771/pexels-photo-264771.jpeg?auto=compress&cs=tinysrgb&w=200">
    <link rel="icon" type="image/jpeg" href="https://images.pexels.com/photos/264771/pexels-photo-264771.jpeg?auto=compress&cs=tinysrgb&w=200">

    <meta property="og:title" content="Mayada Gallery | Ù…Ø¹Ø±Ø¶ Ù…ÙŠØ§Ø¯Ø©">
    <meta property="og:description" content="Ø§ÙƒØªØ´Ù Ø£Ø¬Ù…Ù„ Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§ ÙˆØ§Ù„Ø¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª Ø§Ù„Ø¹ØµØ±ÙŠØ© Ø¨ØªØµØ§Ù…ÙŠÙ… Ø¬Ø°Ø§Ø¨Ø© ÙˆÙ„Ù…Ø³Ø§Øª ÙÙ†ÙŠØ©.">
    <meta property="og:image" content="https://images.pexels.com/photos/264771/pexels-photo-264771.jpeg?auto=compress&cs=tinysrgb&w=600">
    <meta property="og:url" content="https://mayada-gallery.web.app/">
    <meta property="og:type" content="website">
    <script src="https://cdn.tailwindcss.com"></script>

    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body { font-family: 'Cairo', sans-serif; background-color: #000; overflow-x: hidden; }
        .glass-nav { background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(12px); border-bottom: 1px solid rgba(255, 255, 255, 0.05); z-index: 50; height: 60px; }

        #loader { 
            position: fixed; inset: 0; z-index: 9999; 
            background-color: #0f172a; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            transition: opacity 0.5s ease-in-out, visibility 0.5s; 
        }
        .loader-hidden { opacity: 0; visibility: hidden; }

        .mobile-menu { transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1); transform: translateX(-100%); left: 0; right: auto; will-change: transform; top: 60px !important; }
        .mobile-menu.open { transform: translateX(0); }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #111; }
        ::-webkit-scrollbar-thumb { background: #0d9488; border-radius: 4px; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        input[type="file"]::file-selector-button { margin-left: 0.5rem; background-color: #0d9488; color: white; border: 0; border-radius: 0.5rem; padding: 0.25rem 0.75rem; cursor: pointer; }
        .modal-header-fixed { position: sticky; top: 0; z-index: 10; background-color: rgba(31, 41, 55, 0.95); backdrop-filter: blur(5px); }
        .ltr { direction: ltr; }
        .marquee-wrapper { overflow: hidden; width: 100%; position: relative; }
        .marquee-content { display: flex; width: max-content; animation: scrollLeft 45s linear infinite; transform: translateZ(0); backface-visibility: hidden; }
        .marquee-wrapper:hover .marquee-content { animation-play-state: paused; }
        @keyframes scrollLeft { 0% { transform: translateX(0); } 100% { transform: translateX(50%); } }
        .lightbox { position: fixed; inset: 0; z-index: 2000; background: rgba(0,0,0,0.95); display: flex; align-items: center; justify-content: center; opacity: 0; pointer-events: none; transition: opacity 0.2s; }
        .lightbox.active { opacity: 1; pointer-events: all; }
        .lightbox img, .lightbox video { max-width: 95%; max-height: 80vh; border-radius: 8px; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        .lightbox-close { position: absolute; top: 20px; right: 20px; background: rgba(255,255,255,0.2); color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 20px; transition: background 0.2s; z-index: 2001; }
        .lightbox-close:hover { background: rgba(255,0,0,0.6); }
        .slide-media { transition: opacity 0.2s ease-in-out; }

        .trip-card { display: flex; flex-direction: column; height: 100%; }
        .trip-card-body { display: flex; flex-direction: column; flex-grow: 1; }
        .description-content { flex-grow: 1; margin-bottom: 0.5rem; position: relative; }
        .line-clamp-3 { display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }
        .expanded { -webkit-line-clamp: unset; overflow: visible; }
        .read-more-btn { color: #2dd4bf; font-size: 0.75rem; font-weight: bold; margin-top: 4px; cursor: pointer; display: block; }
        .card-bottom-section { margin-top: auto; }

        .install-btn {
            position: fixed; bottom: 20px; left: 20px; z-index: 1000;
            background: linear-gradient(to right, #0d9488, #2563eb);
            color: white; font-weight: bold; padding: 12px 20px;
            border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            display: flex; align-items: center; gap: 8px;
            transition: transform 0.2s;
        }
        .install-btn:active { transform: scale(0.95); }

        .fixed-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100vh; z-index: -1; pointer-events: none;
            transform: translateZ(0); 
            will-change: transform;
        }
        
        /* ØªØ£Ø«ÙŠØ± Ø§Ù„Ù†ÙŠÙˆÙ† Ø§Ù„Ø¯Ø§Ø¦Ù… */
        .neon-card {
            border: 1px solid rgba(20, 184, 166, 0.6); /* Ø­Ø¯ÙˆØ¯ Ù„Ø¨Ù†ÙŠ */
            box-shadow: 0 0 15px rgba(20, 184, 166, 0.3), inset 0 0 10px rgba(20, 184, 166, 0.1);
            transition: box-shadow 0.3s ease;
        }
        .neon-card:hover {
            box-shadow: 0 0 25px rgba(20, 184, 166, 0.6), inset 0 0 15px rgba(20, 184, 166, 0.2);
        }
    </style>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('Service Worker registered'))
                    .catch(err => console.log('Service Worker failed', err));
            });
        }
    </script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
        import { getFirestore, collection, addDoc, query, orderBy, Timestamp, onSnapshot, setDoc, doc, deleteDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js";
        import { getAuth, signInAnonymously, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";
        import { getMessaging, getToken, onMessage } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-messaging.js";

        // --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Mayada Gallery ---
        const COMPANY_NAME = "Mayada Gallery";
        const ADMIN_EMAIL = "mayada@mayada.gallery"; 
        const DEFAULT_PHONE = "201019592797"; 
        const FB_PAGE = "#"; 
        
        // --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Cloudinary ---
        const CLOUD_NAME = "db9h7zm1h"; 
        const UPLOAD_PRESET = "souq_upload"; 
        const CLOUDINARY_URL = `https://api.cloudinary.com/v1_1/${CLOUD_NAME}/auto/upload`;
        
        const VAPID_KEY = "BLXD5VVfej0YCvq4drmoXLPXWu65OL9cl4OXqba-i0dAuX8hkFjE8i-T4k9jQUMZHRBzvTMoCYO3duM7ZMjRmAg";

        // --- Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© ---
        const DEMO_PRODUCTS = [
            {
                id: 'demo1',
                title: 'Ø¨ÙˆÙƒØ³ Ù‡Ø¯Ø§ÙŠØ§ ÙØ§Ø®Ø±',
                price: '450',
                location: 'Ø¨ÙˆÙƒØ³Ø§Øª',
                whatsappPhone: DEFAULT_PHONE,
                description: 'Ø¨ÙˆÙƒØ³ Ù‡Ø¯Ø§ÙŠØ§ Ø£Ù†ÙŠÙ‚ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø³Ø§Ø¹Ø© ÙˆÙ…Ø­ÙØ¸Ø© ÙˆØ¹Ø·Ø±.',
                durationText: 'Ø§Ù„Ø£ÙƒØ«Ø± Ù…Ø¨ÙŠØ¹Ø§Ù‹',
                availableSeats: 5,
                status: 'active',
                mainImageUrl: 'https://images.pexels.com/photos/264771/pexels-photo-264771.jpeg?auto=compress&cs=tinysrgb&w=600',
                images: ['https://images.pexels.com/photos/264771/pexels-photo-264771.jpeg?auto=compress&cs=tinysrgb&w=600']
            },
            {
                id: 'demo2',
                title: 'Ø³Ø§Ø¹Ø© ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠØ©',
                price: '300',
                location: 'Ø¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª',
                whatsappPhone: DEFAULT_PHONE,
                description: 'Ø³Ø§Ø¹Ø© ÙŠØ¯ Ø¨ØªØµÙ…ÙŠÙ… Ø¹ØµØ±ÙŠ ÙˆØ¬Ø°Ø§Ø¨.',
                durationText: 'Ø¹Ø±Ø¶ Ø®Ø§Øµ',
                availableSeats: 10,
                status: 'active',
                mainImageUrl: 'https://images.pexels.com/photos/277390/pexels-photo-277390.jpeg?auto=compress&cs=tinysrgb&w=600',
                images: ['https://images.pexels.com/photos/277390/pexels-photo-277390.jpeg?auto=compress&cs=tinysrgb&w=600']
            }
        ];

        const DEMO_BANNER = [
            { id: 'b1', url: 'https://images.pexels.com/photos/360624/pexels-photo-360624.jpeg?auto=compress&cs=tinysrgb&w=600' },
            { id: 'b2', url: 'https://images.pexels.com/photos/1303082/pexels-photo-1303082.jpeg?auto=compress&cs=tinysrgb&w=600' },
        ];


        let isAdmin = false; 
        let tripsData = []; 
        let bannerData = [];
        let db, auth, messaging; 
        let isEditing = false, editTripId = null, oldImages = [];
        let pendingDelete = null; 
        let currentBookingTrip = null;

        let isTripsReady = false;
        let isBannerReady = false;
        let initialLoadComplete = false; 
        let pendingNotifications = [];
        let unreadNotificationsCount = 0;

        const videoObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (!entry.isIntersecting) {
                    entry.target.pause();
                    const container = entry.target.closest('.trip-card-image-container');
                    if(container) {
                        const btnIcon = container.querySelector('.play-pause-icon');
                        if(btnIcon) btnIcon.className = 'fas fa-play play-pause-icon pl-1';
                    }
                }
            });
        }, { threshold: 0.5 }); 

        function observeVideos(container) {
            const videos = container.querySelectorAll('video');
            videos.forEach(video => videoObserver.observe(video));
        }

        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            if (!localStorage.getItem('appInstalled')) {
                document.getElementById('installAppBtn').classList.remove('hidden');
            }
        });

        window.installApp = async function() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    localStorage.setItem('appInstalled', 'true');
                    document.getElementById('installAppBtn').classList.add('hidden');
                }
                deferredPrompt = null;
            }
        }

        window.addEventListener('appinstalled', () => {
            localStorage.setItem('appInstalled', 'true');
            document.getElementById('installAppBtn').classList.add('hidden');
        });

        function waitForImages(container) {
            const images = container.querySelectorAll('img');
            if (images.length === 0) return Promise.resolve();
            const promises = Array.from(images).map(img => {
                if (img.complete && img.naturalHeight !== 0) return Promise.resolve();
                return new Promise(resolve => { img.onload = resolve; img.onerror = resolve; });
            });
            return Promise.all(promises);
        }

        function tryRemoveLoader() {
            const loader = document.getElementById('loader');
            if (loader && !loader.classList.contains('loader-hidden')) {
                loader.classList.add('loader-hidden');
                initialLoadComplete = true;
                setTimeout(() => {
                    loader.remove();
                    processPendingNotifications();
                }, 500);
            }
        }

        setTimeout(() => { tryRemoveLoader(); }, 3000); 

        const firebaseConfig = {
          apiKey: "AIzaSyDqThFKsdr6h1ceOTsud_kTIP5RuF9x3eM",
          authDomain: "mayada-gallery.firebaseapp.com",
          projectId: "mayada-gallery",
          storageBucket: "mayada-gallery.firebasestorage.app",
          messagingSenderId: "254739920696",
          appId: "1:254739920696:web:6fb02f4e869069ae3633cd",
          measurementId: "G-0WW9N5WDPN"
        };
        
        const tripsPath = `artifacts/${firebaseConfig.projectId}/public/data/products`; 
        const bannerPath = `artifacts/${firebaseConfig.projectId}/public/data/banner`; 

        window.showNotification = function(msg, type) {
            const container = document.getElementById('toast-container');
            if (!container) return;
            const existingToasts = container.querySelectorAll('div');
            for(let toast of existingToasts) { if(toast.innerText.includes(msg)) return; }
            const notif = document.createElement('div');
            notif.className = `transform transition-all duration-300 ease-in-out translate-x-full opacity-0 flex items-center gap-3 px-6 py-4 rounded-xl shadow-2xl backdrop-blur-md border border-white/10 min-w-[300px] ${type === 'error' ? 'bg-red-900/90 text-red-100' : type === 'success' ? 'bg-green-900/90 text-green-100' : 'bg-gray-800/90 text-gray-100'}`;
            let icon = type === 'error' ? '<i class="fas fa-exclamation-circle text-xl"></i>' : type === 'success' ? '<i class="fas fa-check-circle text-xl"></i>' : '<i class="fas fa-info-circle text-teal-400 text-xl"></i>';
            notif.innerHTML = `<div>${icon}</div><div class="font-medium text-sm">${msg}</div>`;
            container.appendChild(notif);
            requestAnimationFrame(() => { notif.classList.remove('translate-x-full', 'opacity-0'); });
            setTimeout(() => { notif.classList.add('opacity-0', 'translate-x-full'); setTimeout(() => notif.remove(), 300); }, 6000);
        }

        async function uploadToCloudinary(file) {
            const formData = new FormData();
            formData.append('file', file);
            formData.append('upload_preset', UPLOAD_PRESET);
            try {
                const response = await fetch(CLOUDINARY_URL, { method: 'POST', body: formData });
                if (!response.ok) {
                    const errData = await response.json();
                    console.error("Cloudinary Error:", errData);
                    throw new Error("ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±: ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Cloudinary");
                }
                const data = await response.json();
                return data.secure_url; 
            } catch (error) { console.error(error); throw error; }
        }

        function isVideo(url) { return url.match(/\.(mp4|webm|ogg|mov)$/i) || url.includes('/video/upload/'); }

        function updateNotificationBadge() {
            const badge = document.getElementById('notificationBadge');
            if (badge) {
                 if (unreadNotificationsCount > 0) {
                     badge.classList.remove('hidden');
                     badge.textContent = unreadNotificationsCount > 9 ? '+9' : unreadNotificationsCount;
                     badge.classList.add('flex', 'items-center', 'justify-center', 'text-[9px]', 'font-bold');
                 } else {
                     badge.classList.add('hidden');
                 }
            }
        }

        function loadNotificationState() {
            const count = localStorage.getItem('unreadNotifs');
            unreadNotificationsCount = count ? parseInt(count) : 0;
            updateNotificationBadge();
        }

        function addToNotificationHistory(title, tripId) {
            let history = JSON.parse(localStorage.getItem('notificationHistory') || "[]");
            if (history.some(n => n.tripId === tripId)) return;
            const newNotif = { title: title, tripId: tripId, timestamp: new Date().toISOString(), read: false };
            history.unshift(newNotif);
            if (history.length > 20) history.pop();
            localStorage.setItem('notificationHistory', JSON.stringify(history));
            unreadNotificationsCount++;
            localStorage.setItem('unreadNotifs', unreadNotificationsCount);
            updateNotificationBadge();
        }

        window.openNotificationCenter = function() { 
             const modal = document.getElementById('notificationModal');
             const listContainer = document.getElementById('notificationList');
             listContainer.innerHTML = '';
             let history = JSON.parse(localStorage.getItem('notificationHistory') || "[]");
             if (history.length === 0) {
                 listContainer.innerHTML = `<div class="flex flex-col items-center py-6 opacity-60"><i class="fas fa-check-circle text-teal-500 text-3xl mb-2"></i><p class="text-sm">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©.</p></div>`;
             } else {
                 history.forEach(notif => {
                    const date = new Date(notif.timestamp);
                    const dateStr = date.toLocaleDateString('ar-EG', {month: 'short', day: 'numeric'}) + ' ' + date.toLocaleTimeString('ar-EG', {hour: '2-digit', minute:'2-digit'});
                    listContainer.innerHTML += `
                    <div class="p-4 bg-teal-900/20 border border-teal-500/30 rounded-lg flex items-start gap-3 mb-2 hover:bg-teal-900/30 transition-colors cursor-pointer" onclick="closeNotificationCenter(); window.location.hash='trip-card-${notif.tripId}'; document.getElementById('trip-card-${notif.tripId}').scrollIntoView({behavior:'smooth', block:'center'});">
                        <div class="bg-teal-500/20 p-2 rounded-full text-teal-400 mt-1"><i class="fas fa-gift"></i></div>
                        <div class="flex-1">
                            <p class="text-white text-sm leading-relaxed">ÙˆØµÙ„ Ø­Ø¯ÙŠØ«Ø§Ù‹: <span class="text-teal-400 font-bold">${notif.title}</span></p>
                            <span class="text-[10px] text-gray-500 mt-1 block dir-ltr text-right"><i class="far fa-clock ml-1"></i> ${dateStr}</span>
                        </div>
                    </div>`;
                 });
             }
             modal.classList.remove('hidden');
             modal.classList.add('flex');
             if (unreadNotificationsCount > 0) {
                 unreadNotificationsCount = 0;
                 localStorage.setItem('unreadNotifs', 0);
                 updateNotificationBadge();
             }
        }
        window.closeNotificationCenter = function() {
            document.getElementById('notificationModal').classList.add('hidden');
            document.getElementById('notificationModal').classList.remove('flex');
        }

        window.requestNotificationPermission = async function() {
            if (!("Notification" in window)) return;
            try {
                const permission = await Notification.requestPermission();
                if (permission === "granted") { try { const token = await getToken(messaging, { vapidKey: VAPID_KEY }); } catch(e) {} }
            } catch (error) { console.error(error); }
        }

        function sendExternalNotification(title, body) {
            if (Notification.permission === "granted" && 'serviceWorker' in navigator) {
                navigator.serviceWorker.ready.then(registration => {
                    registration.showNotification(title, {
                        body: body,
                        icon: 'https://images.pexels.com/photos/264771/pexels-photo-264771.jpeg?auto=compress&cs=tinysrgb&w=200',
                        vibrate: [200, 100, 200],
                        tag: 'mayada-gallery-new-item',
                        data: { url: location.origin + location.pathname + '#trips-section' }
                    });
                });
            }
        }

        function playNotificationSound() {
            try { const audio = new Audio('https://notificationsounds.com/soundfiles/84d2320e837934c2e6467efdcc589f72/file-sounds-1100-long-whistle.mp3'); audio.play().catch(e => {}); } catch (e) {}
        }

        function handleDeepLink() {
            const urlParams = new URLSearchParams(window.location.search);
            const tripId = urlParams.get('tripId');
            if (tripId) {
                const checkData = setInterval(() => {
                    if (initialLoadComplete) {
                        clearInterval(checkData);
                        const tripElement = document.getElementById('trip-card-' + tripId);
                        if (tripElement) {
                            tripElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            tripElement.classList.add('ring-2', 'ring-teal-500');
                            setTimeout(() => tripElement.classList.remove('ring-2', 'ring-teal-500'), 2000);
                        }
                        window.history.replaceState({}, document.title, window.location.pathname);
                    }
                }, 200);
            }
        }

        async function initApp() {
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);
            try { messaging = getMessaging(app); } catch(e) {}

            onAuthStateChanged(auth, (user) => {
                if (user && user.email === ADMIN_EMAIL) {
                    isAdmin = true;
                    updateUIForAdmin(true);
                    showNotification("Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©", "success");
                } else {
                    isAdmin = false;
                    updateUIForAdmin(false);
                    if (!user) signInAnonymously(auth).catch(e => console.log(e));
                }
                listenForTrips();
                listenForBanner();
                handleDeepLink(); 
            });

            document.getElementById('companyName').textContent = COMPANY_NAME;
            document.getElementById('footerCompanyName').textContent = COMPANY_NAME;
            document.querySelectorAll('.fb-link').forEach(l => l.href = FB_PAGE);
            document.querySelectorAll('.wa-link').forEach(l => l.href = `https://wa.me/${DEFAULT_PHONE}`);

            document.addEventListener('click', (event) => {
                const menu = document.getElementById('mobile-menu');
                const btn = document.getElementById('mobileMenuBtn');
                if (menu.classList.contains('open')) {
                    if (!menu.contains(event.target) && !btn.contains(event.target)) {
                        toggleMobileMenu();
                    }
                }
            });

            loadNotificationState();
            requestNotificationPermission();
        }

        window.openLightbox = function(src) {
            const lb = document.getElementById('mainLightbox');
            const container = document.getElementById('lightboxContent');
            container.innerHTML = ''; 
            if (isVideo(src)) container.innerHTML = `<video src="${src}" controls autoplay class="max-w-full max-h-[80vh] rounded-lg"></video>`;
            else container.innerHTML = `<img src="${src}" class="max-w-full max-h-[80vh] rounded-lg">`;
            lb.classList.add('active');
        }
        window.closeLightbox = function() {
            document.getElementById('mainLightbox').classList.remove('active');
            document.getElementById('lightboxContent').innerHTML = ''; 
        }

        window.toggleDescription = function(tripId) {
            const desc = document.getElementById(`desc-${tripId}`);
            const btn = document.getElementById(`btn-desc-${tripId}`);
            if (desc.classList.contains('line-clamp-3')) {
                desc.classList.remove('line-clamp-3');
                desc.classList.add('expanded');
                btn.textContent = 'Ø¹Ø±Ø¶ Ø£Ù‚Ù„';
            } else {
                desc.classList.add('line-clamp-3');
                desc.classList.remove('expanded');
                btn.textContent = 'Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø²ÙŠØ¯';
            }
        }

        window.toggleMute = function(btn) {
            const video = btn.closest('.trip-card-image-container').querySelector('video:not(.opacity-0)');
            if(video) {
                video.muted = !video.muted;
                btn.innerHTML = video.muted ? '<i class="fas fa-volume-mute"></i>' : '<i class="fas fa-volume-up"></i>';
            }
        }

        window.toggleCardPlayback = function(btn) {
            const container = btn.closest('.trip-card-image-container');
            const video = container.querySelector('video:not(.opacity-0)');
            const icon = btn.querySelector('.play-pause-icon');

            if(!video) return;

            if (video.paused) {
                video.play();
                icon.className = 'fas fa-pause play-pause-icon';
            } else {
                video.pause();
                icon.className = 'fas fa-play play-pause-icon pl-1';
            }
        }

        window.changeSlide = function(btn, direction) {
            const card = btn.closest('.trip-card-image-container');
            const mediaItems = card.querySelectorAll('.slide-media');
            const counter = card.querySelector('.slide-counter');
            const mainPlayBtn = card.querySelector('.main-play-btn'); 

            let activeIndex = Array.from(mediaItems).findIndex(el => !el.classList.contains('opacity-0'));

            if(mediaItems[activeIndex].tagName === 'VIDEO') mediaItems[activeIndex].pause();

            mediaItems[activeIndex].classList.add('opacity-0'); 
            mediaItems[activeIndex].style.pointerEvents = 'none'; 

            let nextIndex = activeIndex + direction;
            if (nextIndex >= mediaItems.length) nextIndex = 0; if (nextIndex < 0) nextIndex = mediaItems.length - 1;

            mediaItems[nextIndex].classList.remove('opacity-0'); 
            mediaItems[nextIndex].style.pointerEvents = 'auto'; 

            if(mediaItems[nextIndex].tagName === 'VIDEO') {
                mediaItems[nextIndex].play();
                if(mainPlayBtn) {
                    mainPlayBtn.classList.remove('hidden');
                    const icon = mainPlayBtn.querySelector('.play-pause-icon');
                    if(icon) icon.className = 'fas fa-pause play-pause-icon';
                }
            } else {
                if(mainPlayBtn) mainPlayBtn.classList.add('hidden');
            }

            if(counter) counter.textContent = `${nextIndex + 1}/${mediaItems.length}`;
        }

        function renderTrips(trips) {
            const container = document.getElementById('trips-container');
            videoObserver.disconnect();
            container.innerHTML = ''; 

            trips.forEach((trip) => {
                const card = document.createElement('div');
                card.id = `trip-card-${trip.id}`; 
                // ÙƒÙ„Ø§Ø³ Ø§Ù„Ù†ÙŠÙˆÙ†
                card.className = "trip-card neon-card w-11/12 md:w-full max-w-sm mx-auto bg-gray-900 rounded-2xl overflow-hidden transition-all duration-150 transform hover:-translate-y-1";

                let mediaList = Array.isArray(trip.images) ? trip.images : (trip.mainImageUrl ? [trip.mainImageUrl] : ['https://via.placeholder.com/400x300']);
                let mediaHtml = '';
                let controlsHtml = '';
                let isTripVideo = mediaList.length > 0 && isVideo(mediaList[0]); 

                if (mediaList.length > 0) {
                    mediaHtml = mediaList.map((url, index) => {
                        const isVid = isVideo(url);
                        if (isVid) return `<video src="${url}" class="slide-media absolute inset-0 w-full h-full object-cover transition-opacity duration-200 ${index === 0 ? '' : 'opacity-0'}" muted loop playsinline style="${index === 0 ? 'pointer-events: auto' : 'pointer-events: none'}"></video>`;
                        else return `<img src="${url}" class="slide-media absolute inset-0 w-full h-full object-cover transition-opacity duration-200 ${index === 0 ? '' : 'opacity-0'}" loading="lazy" style="${index === 0 ? 'pointer-events: auto' : 'pointer-events: none'}" onclick="event.stopPropagation(); openLightbox(this.getAttribute('src'))">`;
                    }).join('');

                    controlsHtml = `
                        <div class="absolute inset-0 flex justify-between items-center px-2 z-20 pointer-events-none">
                            ${mediaList.length > 1 ? `
                            <button onclick="event.stopPropagation(); changeSlide(this, -1)" class="bg-black/40 hover:bg-black/70 text-white w-8 h-8 rounded-full flex items-center justify-center backdrop-blur-sm pointer-events-auto transition-opacity opacity-70 hover:opacity-100"><i class="fas fa-chevron-right"></i></button>
                            <button onclick="event.stopPropagation(); changeSlide(this, 1)" class="bg-black/40 hover:bg-black/70 text-white w-8 h-8 rounded-full flex items-center justify-center backdrop-blur-sm pointer-events-auto transition-opacity opacity-70 hover:opacity-100"><i class="fas fa-chevron-left"></i></button>
                            ` : ''}
                        </div>
                        <div class="main-play-btn absolute inset-0 z-10 flex items-center justify-center pointer-events-none ${isTripVideo ? '' : 'hidden'}">
                             <button onclick="event.stopPropagation(); toggleCardPlayback(this)" class="bg-black/40 hover:bg-teal-600/90 text-white w-14 h-14 rounded-full flex items-center justify-center backdrop-blur-sm transition-transform hover:scale-110 pointer-events-auto group shadow-2xl border border-white/20">
                                <i class="fas fa-play play-pause-icon pl-1 text-xl group-hover:text-white"></i>
                             </button>
                        </div>
                        <div class="absolute bottom-4 left-4 flex gap-2 z-20 pointer-events-auto">
                             ${mediaList.some(u => isVideo(u)) ? `
                             <button onclick="event.stopPropagation(); toggleMute(this)" class="bg-black/60 text-white w-8 h-8 rounded-full flex items-center justify-center hover:bg-black/80"><i class="fas fa-volume-mute"></i></button>
                             <button onclick="event.stopPropagation(); openLightbox(this.closest('.trip-card-image-container').querySelector('.slide-media:not(.opacity-0)').src)" class="bg-black/60 text-white w-8 h-8 rounded-full flex items-center justify-center hover:bg-black/80"><i class="fas fa-expand"></i></button>
                             ` : ''}
                        </div>
                        ${mediaList.length > 1 ? `<div class="absolute top-4 left-4 bg-black/60 text-white text-[10px] px-2 py-1 rounded-full backdrop-blur-sm z-20 slide-counter">1/${mediaList.length}</div>` : ''}`;
                }

                const tripPhone = trip.whatsappPhone || DEFAULT_PHONE;
                
                let isExpired = trip.status === 'expired' || (trip.availableSeats && parseInt(trip.availableSeats) <= 0);
                const statusTag = isExpired ? `<div class="absolute top-4 left-4 bg-red-600 text-white text-[10px] font-bold px-2 py-1 rounded shadow-md z-30">Ù†ÙØ°Øª Ø§Ù„ÙƒÙ…ÙŠØ© ğŸš«</div>` : '';

                // Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… - ØªÙ… Ø§Ù„Ù†Ù‚Ù„ Ø®Ø§Ø±Ø¬ Ø§Ù„ØµÙˆØ±Ø© Ù„Ø¶Ù…Ø§Ù† Ø¹Ù…Ù„Ù‡Ø§
                const isDemo = trip.id.toString().startsWith('demo');
                const adminControls = isAdmin ? `
                    <div class="flex flex-wrap gap-2 mb-3 border-b border-gray-700 pb-2">
                        <button onclick="toggleTripStatus('${trip.id}', '${trip.status === 'expired' ? 'active' : 'expired'}')" class="flex-1 ${trip.status === 'expired' ? 'bg-green-900/30 text-green-500' : 'bg-yellow-900/30 text-yellow-500'} py-1.5 rounded-lg text-xs font-bold hover:bg-opacity-70 transition-colors"><i class="fas ${trip.status === 'expired' ? 'fa-redo' : 'fa-ban'}"></i> Ø§Ù„Ø­Ø§Ù„Ø©</button>
                        <button onclick="prepareEditTrip('${trip.id}')" class="flex-1 bg-blue-900/30 text-blue-500 py-1.5 rounded-lg text-xs font-bold hover:bg-blue-900/50 transition-colors"><i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„</button>
                        <button onclick="confirmDelete('${trip.id}', '${trip.title}', 'trip')" class="flex-1 bg-red-900/30 text-red-500 py-1.5 rounded-lg text-xs font-bold hover:bg-red-900/50 transition-colors"><i class="fas fa-trash-alt"></i> Ø­Ø°Ù</button>
                    </div>` : '';

                card.innerHTML = `
                    <div class="trip-card-image-container relative h-96 flex-shrink-0 overflow-hidden bg-gray-800 cursor-pointer" onclick="openBookingOptions('${trip.title}', '${isDemo ? 'DEMO' : trip.code}', '${trip.price}', '${tripPhone}')">
                        ${mediaHtml} ${controlsHtml}
                        <div class="absolute top-4 right-4 bg-teal-600/90 text-white text-[10px] font-bold px-2 py-1 rounded shadow-md z-20 flex items-center gap-1">
                            ${trip.durationText || 'Ø¬Ø¯ÙŠØ¯'}
                        </div>
                        ${statusTag}
                        <button onclick="event.stopPropagation(); shareTrip('${trip.title}', '?tripId=${trip.id}')" class="absolute bottom-4 right-4 bg-white text-gray-900 w-8 h-8 rounded-full shadow-lg flex items-center justify-center hover:scale-110 transition-transform z-20"><i class="fas fa-share-alt"></i></button>
                    </div>
                    <div class="trip-card-body p-5 bg-gray-800/50 rounded-b-2xl"> 
                        ${adminControls}
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="text-lg font-bold text-white leading-tight">${trip.title}</h3>
                            <span class="text-teal-400 font-extrabold text-lg whitespace-nowrap">${trip.price} <span class="text-xs font-normal text-gray-300">Ø¬.Ù…</span></span>
                        </div>
                        
                        <div class="description-content text-gray-300 text-xs font-medium relative" onclick="toggleDescription('${trip.id}')">
                            <div id="desc-${trip.id}" class="line-clamp-3">${trip.description}</div>
                            ${trip.description.length > 80 ? `<span id="btn-desc-${trip.id}" class="read-more-btn">Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø²ÙŠØ¯</span>` : ''}
                        </div>

                        <div class="card-bottom-section">
                            <div class="text-gray-300 text-[11px] border-t border-gray-700 pt-3 space-y-2">
                                <div class="flex justify-between border-t border-gray-700/50 pt-2 mt-2">
                                    <span><i class="fas fa-tag ml-1 text-blue-500"></i> ${trip.location}</span>
                                    <span class="${isExpired ? 'text-red-500' : 'text-green-500'}"><i class="fas fa-box-open ml-1"></i> Ø§Ù„ÙƒÙ…ÙŠØ©: ${trip.availableSeats > 0 ? trip.availableSeats : '0'}</span>
                                </div>
                            </div>
                            ${!isExpired ? `<button onclick="openBookingOptions('${trip.title}', '${isDemo ? 'DEMO' : trip.code}', '${trip.price}', '${tripPhone}')" class="w-full bg-gradient-to-r from-teal-600 to-blue-600 hover:from-teal-700 text-white font-bold py-2.5 px-4 rounded-xl shadow-lg mt-4 text-sm flex justify-center items-center gap-2 transition-transform active:scale-95"><i class="fas fa-shopping-cart text-lg"></i> Ø§Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†</button>` : `<button disabled class="w-full bg-gray-700 text-gray-500 cursor-not-allowed font-bold py-2.5 px-4 rounded-xl shadow-lg mt-4 text-sm flex justify-center items-center gap-2"><i class="fas fa-times-circle text-lg"></i> ØºÙŠØ± Ù…ØªÙˆÙØ±</button>`}
                        </div>
                    </div>`;
                container.appendChild(card);
            });
            observeVideos(container);
        }

        function renderBanner(items) {
            const track = document.getElementById('marquee-track');
            const videoContainer = document.getElementById('video-container');
            const videoSection = document.getElementById('video-section');
            const images = items.filter(item => !isVideo(item.url));
            const videos = items.filter(item => isVideo(item.url));

            if (images.length === 0) track.innerHTML = ''; 
            else {
                const allImages = [...images, ...images, ...images]; 
                track.innerHTML = allImages.map(img => `
                    <div class="relative w-48 h-32 md:w-60 md:h-40 mx-2 flex-shrink-0 rounded-xl overflow-hidden border border-gray-800 group bg-gray-900 transform translate-z-0">
                        <img src="${img.url}" onclick="openLightbox(this.getAttribute('src'))" loading="lazy" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110 opacity-90 hover:opacity-100 cursor-pointer">
                        ${isAdmin && !img.id.startsWith('b') ? `<button onclick="event.stopPropagation(); confirmDelete('${img.id}', 'ØµÙˆØ±Ø© Ù…Ù† Ø§Ù„Ù…Ø¹Ø±Ø¶', 'banner')" class="absolute top-1 right-1 bg-red-600/80 hover:bg-red-600 text-white w-7 h-7 rounded-full flex items-center justify-center text-sm shadow-md z-10 backdrop-blur-sm transition-all hover:scale-110"><i class="fas fa-trash-alt"></i></button>` : ''}
                    </div>`).join('');
            }

            if (videos.length > 0) {
                videoSection.classList.remove('hidden');
                // Ø²ÙŠØ§Ø¯Ø© Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù‡Ù†Ø§
                videoContainer.innerHTML = videos.map(vid => `
                    <div class="relative w-full mx-auto rounded-2xl overflow-hidden shadow-2xl border border-gray-700 bg-gray-900/50 mb-8 last:mb-0">
                        <video controls playsinline loop class="w-full h-72 md:h-[500px] object-cover cursor-pointer"><source src="${vid.url}" type="video/mp4"></video>
                         ${isAdmin && !vid.id.startsWith('b') ? `<button onclick="confirmDelete('${vid.id}', 'Ø§Ù„ÙÙŠØ¯ÙŠÙˆ', 'banner')" class="absolute top-4 right-4 bg-red-600 hover:bg-red-700 text-white px-3 py-1.5 rounded-lg text-sm shadow-lg z-10 backdrop-blur-md flex items-center gap-2"><i class="fas fa-trash-alt"></i> Ø­Ø°Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</button>` : ''}
                    </div>`).join('');
                observeVideos(videoContainer);
            } else { videoSection.classList.add('hidden'); videoContainer.innerHTML = ''; }
        }

        window.handleTripSubmit = async function(event) {
            event.preventDefault(); if (!isAdmin) return;
            const btn = document.getElementById('submitBtn'); const originalText = btn.innerHTML; btn.innerHTML = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...'; btn.disabled = true;
            
            const title = document.getElementById('tripTitle').value; 
            const price = document.getElementById('tripPrice').value; 
            const location = document.getElementById('tripLocation').value; 
            const whatsappPhone = document.getElementById('tripPhone').value; 
            const description = document.getElementById('tripDesc').value; 
            const availableSeats = parseInt(document.getElementById('availableSeats').value) || 0; 
            const durationText = document.getElementById('durationText').value || 'Ø¬Ø¯ÙŠØ¯'; 

            const imageFiles = document.getElementById('tripImageFile').files; let imagesArray = [];
            if (isEditing) imagesArray = [...oldImages];
            if (imageFiles.length > 0) {
                try { 
                    const uploadPromises = Array.from(imageFiles).map(file => uploadToCloudinary(file)); 
                    const newImages = await Promise.all(uploadPromises); 
                    if (isEditing) imagesArray = [...imagesArray, ...newImages]; else imagesArray = newImages; 
                } catch (e) { 
                    showNotification(e.message, "error"); 
                    btn.innerHTML = originalText; btn.disabled = false; return; 
                }
            } else if (!isEditing && imagesArray.length === 0) { showNotification("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„", "error"); btn.innerHTML = originalText; btn.disabled = false; return; }
            try { 
                const tripData = { title, price, location, whatsappPhone, description, availableSeats, durationText, mainImageUrl: imagesArray[0], images: imagesArray }; 
                if (isEditing) { 
                    await updateDoc(doc(db, tripsPath, editTripId), tripData); showNotification("ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­", "success"); 
                } else { 
                    const code = 'GIFT-' + Math.floor(1000 + Math.random() * 9000); 
                    await addDoc(collection(db, tripsPath), { ...tripData, code, status: 'active', createdAt: Timestamp.now() }); showNotification("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¬Ø§Ø­", "success"); 
                } 
                closeTripModal(); 
            } catch (error) { 
                console.error(error);
                showNotification("Ø®Ø·Ø£ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ØªØ£ÙƒØ¯ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ§Øª Firebase Rules", "error"); 
            } finally { btn.innerHTML = originalText; btn.disabled = false; }
        }

        window.prepareEditTrip = function(id) {
            if (!isAdmin) return; const trip = tripsData.find(t => t.id === id); isEditing = true; editTripId = id; oldImages = Array.isArray(trip.images) ? trip.images : (trip.mainImageUrl ? [trip.mainImageUrl] : []);
            const modal = document.getElementById('addTripModal'); modal.classList.remove('hidden'); modal.classList.add('flex');
            document.getElementById('modalTitle').textContent = "ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬"; document.getElementById('submitBtn').innerHTML = `<i class="fas fa-save ml-1"></i> Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª`;
            document.getElementById('tripTitle').value = trip.title; 
            document.getElementById('tripLocation').value = trip.location; 
            document.getElementById('tripPrice').value = trip.price; 
            document.getElementById('tripPhone').value = trip.whatsappPhone || ''; 
            document.getElementById('availableSeats').value = trip.availableSeats; 
            document.getElementById('tripDesc').value = trip.description;
            document.getElementById('durationText').value = trip.durationText || '';
        }

        window.toggleLoginModal = function() { document.getElementById('loginModal').classList.toggle('hidden'); document.getElementById('loginModal').classList.toggle('flex'); document.getElementById('mobile-menu').classList.remove('open'); }
        window.handleLogin = async function(e) { e.preventDefault(); try { await signInWithEmailAndPassword(auth, document.getElementById('emailInput').value, document.getElementById('passInput').value); window.toggleLoginModal(); } catch (error) { showNotification("Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø·Ø£", "error"); } }
        window.handleLogout = async function() { await signOut(auth); window.location.reload(); }

        function queueNewTripNotification(title, tripId) {
             if (!isAdmin) {
                addToNotificationHistory(title, tripId);
                pendingNotifications.push({title, tripId});
             }
        }

        function notifyNewTripLive(title, tripId) {
             if (!isAdmin) {
                addToNotificationHistory(title, tripId);
                showNotification(`ÙˆØµÙ„ Ø­Ø¯ÙŠØ«Ø§Ù‹: ${title}`, "info");
                playNotificationSound();
                sendExternalNotification(`Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯: ${title}`, `ØªÙÙ‚Ø¯ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¢Ù† ÙÙŠ Ø§Ù„Ù…Ø¹Ø±Ø¶`);
             }
        }

        function processPendingNotifications() {
            if (pendingNotifications.length > 0) {
                pendingNotifications.forEach((notif, index) => {
                    setTimeout(() => {
                        showNotification(`ÙˆØµÙ„ Ø­Ø¯ÙŠØ«Ø§Ù‹: ${notif.title}`, "info");
                        playNotificationSound();
                    }, index * 800); 
                });
                const last = pendingNotifications[pendingNotifications.length -1];
                sendExternalNotification(`Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯: ${last.title}`, `ØªÙÙ‚Ø¯ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¢Ù† ÙÙŠ Ø§Ù„Ù…Ø¹Ø±Ø¶`);
                pendingNotifications = [];
            }
        }

        function listenForTrips() { 
            onSnapshot(query(collection(db, tripsPath), orderBy("createdAt", "desc")), (snap) => { 
                tripsData = []; 
                snap.forEach(doc => tripsData.push({id: doc.id, ...doc.data()})); 
                
                // --- Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙØ§Ø±ØºØ© ---
                if (tripsData.length === 0) {
                    tripsData = DEMO_PRODUCTS;
                }
                
                renderTrips(tripsData);

                if (!initialLoadComplete) {
                     waitForImages(document.getElementById('trips-container')).then(() => {
                        isTripsReady = true;
                        tryRemoveLoader();
                     });
                } else {
                     snap.docChanges().forEach(change => {
                        if (change.type === "added") {
                            const newTrip = change.doc.data();
                            if (newTrip && newTrip.createdAt) {
                                const nowSeconds = Timestamp.now().seconds;
                                const createdSeconds = newTrip.createdAt.seconds;
                                if (Math.abs(nowSeconds - createdSeconds) < 300) { 
                                    notifyNewTripLive(newTrip.title, change.doc.id);
                                }
                            }
                        }
                    });
                     waitForImages(document.getElementById('trips-container'));
                }
            }); 
        }
        function listenForBanner() { 
            onSnapshot(query(collection(db, bannerPath), orderBy("createdAt", "desc")), (snap) => { 
                bannerData = []; 
                snap.forEach(doc => bannerData.push({id: doc.id, ...doc.data()})); 
                
                // --- Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØµÙˆØ± Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙØ§Ø±ØºØ© ---
                if (bannerData.length === 0) {
                    bannerData = DEMO_BANNER;
                }

                renderBanner(bannerData); 

                if (!initialLoadComplete) {
                     waitForImages(document.getElementById('marquee-track')).then(() => {
                        isBannerReady = true;
                        tryRemoveLoader();
                     });
                }
            }); 
        }

        window.confirmDelete = function(id, title, type) { 
            if(id.startsWith('demo') || id.startsWith('b')) {
                showNotification("Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©", "error");
                return;
            }
            pendingDelete = { id, title, type }; document.getElementById('deleteModal').classList.remove('hidden'); document.getElementById('deleteModal').classList.add('flex'); 
        }
        window.executeDelete = async function() { if(!pendingDelete) return; try { await deleteDoc(doc(db, pendingDelete.type==='trip'?tripsPath:bannerPath, pendingDelete.id)); showNotification("ØªÙ… Ø§Ù„Ø­Ø°Ù", "success"); } catch(e){showNotification("Ø®Ø·Ø£","error")} window.closeDeleteModal(); }
        window.closeDeleteModal = function() { document.getElementById('deleteModal').classList.add('hidden'); document.getElementById('deleteModal').classList.remove('flex'); }
        
        window.openBookingOptions = function(title, code, price, phone) { currentBookingTrip = { title, code, price, phone }; document.getElementById('bookingOptionsModal').classList.remove('hidden'); document.getElementById('bookingOptionsModal').classList.add('flex'); }
        window.closeBookingOptions = function() { document.getElementById('bookingOptionsModal').classList.add('hidden'); document.getElementById('bookingOptionsModal').classList.remove('flex'); }
        window.handleInquiry = function() { window.open(`https://wa.me/${currentBookingTrip.phone}?text=${encodeURIComponent(`Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…ØŒ Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ø§Ù„Ù…Ù†ØªØ¬: ${currentBookingTrip.title}`)}`); closeBookingOptions(); }
        window.openBookingForm = function() { closeBookingOptions(); document.getElementById('formTripTitle').value=currentBookingTrip.title; document.getElementById('formTripPrice').value=currentBookingTrip.price; document.getElementById('formCount').value=1; window.updateTotalPrice(); document.getElementById('bookingFormModal').classList.remove('hidden'); document.getElementById('bookingFormModal').classList.add('flex'); }
        window.closeBookingForm = function() { document.getElementById('bookingFormModal').classList.add('hidden'); document.getElementById('bookingFormModal').classList.remove('flex'); }
        window.updateTotalPrice = function() { document.getElementById('formTotal').textContent = (parseInt(document.getElementById('formCount').value||1) * parseFloat(currentBookingTrip.price||0)).toLocaleString() + ' Ø¬.Ù…'; }
        
        window.finalizeBooking = function(e) { 
            e.preventDefault(); 
            const msg = `Ù…Ø±Ø­Ø¨Ø§Ù‹ Mayada GalleryØŒ Ø£Ø±ØºØ¨ ÙÙŠ Ø·Ù„Ø¨:
ğŸ“¦ Ø§Ù„Ù…Ù†ØªØ¬: ${currentBookingTrip.title}
ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: ${document.getElementById('clientName').value}
ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ: ${document.getElementById('clientPhone').value}
ğŸ”¢ Ø§Ù„Ø¹Ø¯Ø¯: ${document.getElementById('formCount').value}
ğŸ’° Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${document.getElementById('formTotal').textContent}`;
            
            window.open(`https://wa.me/${currentBookingTrip.phone}?text=${encodeURIComponent(msg)}`); 
            closeBookingForm(); 
        }
        
        window.toggleTripStatus = async function(id, status) { if(id.startsWith('demo')) return; await setDoc(doc(db, tripsPath, id), {status}, {merge:true}); }
        window.handleBannerSubmit = async function(e) { e.preventDefault(); const files = document.getElementById('bannerFiles').files; if(!files.length) return; document.getElementById('bannerSubmitBtn').innerHTML='...'; try { const urls = await Promise.all([...files].map(f=>uploadToCloudinary(f))); await Promise.all(urls.map(url=>addDoc(collection(db, bannerPath), {url, createdAt: Timestamp.now()}))); showNotification("ØªÙ…","success"); window.closeBannerModal(); } catch(e){ showNotification(e.message || "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ø´Ø±", "error"); } document.getElementById('bannerSubmitBtn').innerHTML='ØªØ£ÙƒÙŠØ¯'; }
        window.toggleTripModal = function() { isAdmin? (isEditing=false, document.getElementById('addTripModal').classList.toggle('hidden'), document.getElementById('addTripModal').classList.toggle('flex'), document.getElementById('addTripForm').reset()) : null; }
        window.toggleBannerModal = function() { isAdmin? (document.getElementById('addBannerModal').classList.toggle('hidden'), document.getElementById('addBannerModal').classList.toggle('flex')) : null; }
        window.closeTripModal = function() { document.getElementById('addTripModal').classList.add('hidden'); document.getElementById('addTripModal').classList.remove('flex'); }
        window.closeBannerModal = function() { document.getElementById('addBannerModal').classList.add('hidden'); document.getElementById('addBannerModal').classList.remove('flex'); }
        window.toggleMobileMenu = function() { document.getElementById('mobile-menu').classList.toggle('open'); }
        window.shareTrip = async function(t,l) { try{await navigator.clipboard.writeText(location.origin+location.pathname+l); showNotification("Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·","success")}catch(e){} }
        window.previewBannerImages = function(e) { document.getElementById('bannerPreview').innerHTML = [...e.target.files].map(f => `<${f.type.startsWith('video')?'video':'img'} src="${URL.createObjectURL(f)}" class="w-16 h-16 object-cover border border-gray-600 rounded">`).join(''); }
        
        function updateUIForAdmin(l) { 
            const d=document.getElementById('desktopAdminGroup'), ml=document.getElementById('mobileLoginBtn'), mo=document.getElementById('mobileLogoutBtn'), ma=document.getElementById('mobileAdminActions');
            if(l){ d.classList.remove('hidden'); ml.classList.add('hidden'); mo.classList.remove('hidden'); ma.classList.remove('hidden'); ma.classList.add('grid'); }
            else { d.classList.add('hidden'); ml.classList.remove('hidden'); mo.classList.add('hidden'); ma.classList.add('hidden'); ma.classList.remove('grid'); }
            renderTrips(tripsData); renderBanner(bannerData);
        }
        window.onload = initApp;
    </script>
</head>
<body class="bg-gray-900 min-h-screen relative text-gray-100 selection:bg-teal-500 selection:text-white no-scrollbar">

    <div id="loader">
        <div class="text-center">
            <i class="fas fa-gift text-6xl text-teal-500 animate-bounce mb-4"></i>
            <h1 class="text-4xl font-black text-white tracking-widest">Mayada Gallery</h1>
            <p class="text-gray-300 mt-2 text-sm animate-pulse">Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§...</p>
        </div>
    </div>

    <div id="toast-container" class="fixed top-24 left-1/2 -translate-x-1/2 z-[9999] flex flex-col gap-2 w-max max-w-[90vw] pointer-events-none"></div>

    <button id="installAppBtn" onclick="installApp()" class="hidden install-btn">
        <i class="fas fa-download"></i> ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    </button>

    <div id="mainLightbox" class="lightbox">
        <div class="lightbox-close" onclick="closeLightbox()"><i class="fas fa-times"></i></div>
        <div id="lightboxContent"></div>
    </div>

    <div class="fixed-bg">
        <img src="https://images.pexels.com/photos/1666065/pexels-photo-1666065.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1" class="w-full h-full object-cover object-center opacity-40">
        <div class="absolute inset-0 bg-black/60"></div> 
    </div>

    <div class="relative z-10 flex flex-col min-h-screen">
        <nav class="glass-nav sticky top-0 w-full flex items-center">
            <div class="w-full px-4 md:px-8 flex justify-between items-center relative h-full">
                <!-- Logo -->
                <button onclick="window.location.reload()" class="flex-shrink-0 text-lg md:text-xl font-black text-white flex items-center gap-2 hover:text-teal-400">
                    <i class="fas fa-gem text-teal-400"></i> <span id="companyName">Mayada Gallery</span>
                </button>

                <!-- Links Centered -->
                <div class="hidden lg:flex flex-1 justify-center items-center gap-6 text-sm font-semibold">
                    <a href="#" class="hover:text-teal-400">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
                    <a href="#trips-section" class="hover:text-teal-400">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</a>
                    <a href="#" target="_blank" class="hover:text-teal-400 fb-link">ÙÙŠØ³Ø¨ÙˆÙƒ</a>
                </div>

                <!-- Right Controls -->
                <div class="flex-shrink-0 flex items-center gap-3">
                    <div class="hidden md:block">
                        <div id="desktopAdminGroup" class="hidden flex items-center gap-2">
                            <button onclick="toggleBannerModal()" class="bg-white/5 hover:bg-white/10 border border-white/10 text-white px-2 py-1 rounded-lg text-xs flex items-center gap-1 backdrop-blur-md transition-all"><i class="fas fa-images text-teal-400"></i> Ø§Ù„Ù…Ø¹Ø±Ø¶</button>
                            <button onclick="toggleTripModal()" class="bg-white/5 hover:bg-white/10 border border-white/10 text-white px-2 py-1 rounded-lg text-xs flex items-center gap-1 backdrop-blur-md transition-all"><i class="fas fa-plus text-teal-400"></i> Ù…Ù†ØªØ¬</button>
                            <button onclick="handleLogout()" class="text-red-400 hover:text-red-300 text-xs px-2"><i class="fas fa-sign-out-alt"></i></button>
                        </div>
                    </div>
                    <button id="notificationBell" onclick="openNotificationCenter()" class="relative text-white text-lg p-2 hover:text-teal-400 transition-colors">
                        <i class="fas fa-bell"></i>
                        <span id="notificationBadge" class="absolute top-0 right-0 w-4 h-4 bg-red-600 rounded-full hidden border-2 border-gray-900"></span>
                    </button>
                    <button id="mobileMenuBtn" onclick="toggleMobileMenu()" class="lg:hidden text-white text-lg p-2 hover:text-teal-400 transition-colors"><i class="fas fa-bars"></i></button>
                </div>
            </div>
        </nav>

        <!-- Mobile Menu -->
        <div id="mobile-menu" class="mobile-menu fixed w-64 h-auto min-h-[50vh] bg-gray-900/95 backdrop-blur-xl z-50 p-5 shadow-2xl flex flex-col gap-6 rounded-br-2xl border-r border-b border-gray-700">
            <div class="flex justify-between items-center border-b border-gray-700 pb-4">
                <span class="text-lg font-bold text-white">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</span>
                <button onclick="toggleMobileMenu()" class="text-gray-400 hover:text-white w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-800"><i class="fas fa-times"></i></button>
            </div>
            <nav class="flex flex-col space-y-4 text-base font-semibold">
                <a href="#" class="text-gray-300 hover:text-teal-400 flex items-center gap-3" onclick="toggleMobileMenu()"><i class="fas fa-home w-5 text-center"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
                <a href="#trips-section" class="text-gray-300 hover:text-teal-400 flex items-center gap-3" onclick="toggleMobileMenu()"><i class="fas fa-gift w-5 text-center"></i> Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</a>
                <a href="#" target="_blank" class="text-gray-300 hover:text-teal-400 flex items-center gap-3 fb-link" onclick="toggleMobileMenu()"><i class="fab fa-facebook w-5 text-center"></i> ÙÙŠØ³Ø¨ÙˆÙƒ</a>
            </nav>
            <div class="mt-2 border-t border-gray-700 pt-4">
                <button id="mobileLoginBtn" onclick="toggleLoginModal()" class="w-full text-gray-300 hover:text-white border border-gray-600/50 bg-gray-800/50 px-4 py-2.5 rounded-xl transition-all flex items-center gap-3 mb-3"><i class="fas fa-lock w-5 text-center text-teal-500"></i> <span>Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</span></button>
                <button id="mobileLogoutBtn" onclick="handleLogout()" class="hidden w-full text-red-400 hover:text-red-300 border border-red-900/30 bg-red-900/10 px-4 py-2.5 rounded-xl transition-all flex items-center gap-3 mb-3"><i class="fas fa-sign-out-alt w-5 text-center"></i> <span>Ø®Ø±ÙˆØ¬</span></button>
                <div id="mobileAdminActions" class="hidden grid-cols-2 gap-3">
                    <button onclick="toggleBannerModal(); toggleMobileMenu();" class="flex flex-col items-center justify-center bg-teal-900/20 border border-teal-500/30 text-teal-100 py-3 rounded-xl text-xs gap-2 hover:bg-teal-900/40"><i class="fas fa-images text-lg"></i> Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±</button>
                    <button onclick="toggleTripModal(); toggleMobileMenu();" class="flex flex-col items-center justify-center bg-teal-900/20 border border-teal-500/30 text-teal-100 py-3 rounded-xl text-xs gap-2 hover:bg-teal-900/40"><i class="fas fa-plus text-lg"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</button>
                </div>
            </div>
        </div>

        <header class="flex-grow flex flex-col items-center justify-center text-center pt-4 pb-6 overflow-hidden">
            <div class="w-full mb-4 relative">
                <div class="marquee-wrapper"><div id="marquee-track" class="marquee-content py-2"></div></div>
            </div>
            <div class="max-w-3xl px-4 relative z-10">
                <h1 class="text-2xl md:text-3xl lg:text-4xl font-black text-white mb-4 leading-tight">Ø§Ø¬Ø¹Ù„ ÙƒÙ„ Ù…Ù†Ø§Ø³Ø¨Ø© Ø°ÙƒØ±Ù‰ <span class="text-transparent bg-clip-text bg-gradient-to-r from-teal-400 to-blue-500">Ù„Ø§ ØªÙÙ†Ø³Ù‰</span></h1>
                
                <span class="inline-block py-1 px-3 rounded-full bg-teal-500/20 border border-teal-500/50 text-teal-300 text-xs font-bold mb-6 animate-pulse">Ù‡Ø¯Ø§ÙŠØ§ Ø¹ØµØ±ÙŠØ© Ø¨Ù„Ù…Ø³Ø§Øª ÙÙ†ÙŠØ©</span>
                
                <p class="text-sm md:text-base text-gray-300 mb-8 max-w-2xl mx-auto">ØªØ´ÙƒÙŠÙ„Ø© ÙˆØ§Ø³Ø¹Ø© Ù…Ù† Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§ ÙˆØ§Ù„Ø¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª Ø§Ù„Ù…Ù…ÙŠØ²Ø© Ø§Ù„ØªÙŠ ØªÙ†Ø§Ø³Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø°ÙˆØ§Ù‚.</p>
                <a href="#trips-section" class="inline-block bg-teal-600 hover:bg-teal-700 text-white font-bold py-3 px-8 rounded-full shadow-lg hover:scale-105 active:scale-95 transition-all text-sm md:text-base">ØªØ³ÙˆÙ‚ Ø§Ù„Ø¢Ù†</a>
            </div>
        </header>

        <section id="video-section" class="hidden w-full max-w-md mx-auto px-4 pb-12"><div id="video-container" class="w-full"></div></section>

        <section id="trips-section" class="py-10">
            <div class="container mx-auto px-6">
                <div class="flex justify-between items-end mb-12">
                    <div><h2 class="text-2xl md:text-3xl font-bold text-white mb-2">Ø£Ø­Ø¯Ø« Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h2><div class="h-1 w-20 bg-teal-500 rounded"></div></div>
                </div>
                <div id="trips-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8"></div>
            </div>
        </section>

        <footer class="bg-black/90 text-gray-400 py-10 border-t border-gray-800">
            <div class="container mx-auto px-6 text-center">
                <p class="mb-4 text-xl font-bold text-white" id="footerCompanyName">Mayada Gallery</p>
                <p class="mb-4 text-xs text-gray-500">Ø£Ø³ÙÙ„ ÙƒØ¨Ø±Ù‰ Ø§Ù„ØµØ§ØºØ© â€“ Ø§Ù„ÙƒÙˆØ¨Ø±ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯ â€“ Mayada</p>
                <div class="flex justify-center gap-6">
                    <a href="#" target="_blank" class="text-3xl hover:text-green-500 transition-colors wa-link"><i class="fab fa-whatsapp"></i></a>
                     <a href="#" target="_blank" class="text-3xl hover:text-blue-500 transition-colors fb-link"><i class="fab fa-facebook"></i></a>
                </div>
                <p class="text-sm mt-6">Â© 2026 Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Ù„Ù€ Mayada Gallery.</p>
            </div>
        </footer>
    </div>

    <!-- Modals -->
    <div id="loginModal" class="fixed inset-0 z-[100] hidden items-center justify-center bg-black/80 backdrop-blur-sm p-4"><div class="bg-gray-800 border border-teal-500/50 w-full max-w-sm rounded-2xl shadow-2xl p-6"><h3 class="text-xl font-bold text-center text-white mb-4">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h3><form id="loginForm" onsubmit="handleLogin(event)" class="space-y-4"><input type="email" id="emailInput" required class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-teal-500 ltr" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ"><input type="password" id="passInput" required class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-teal-500 ltr" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"><button type="submit" id="loginBtn" class="w-full bg-teal-600 hover:bg-teal-700 text-white font-bold py-3 rounded-lg transition-colors">Ø¯Ø®ÙˆÙ„</button><button type="button" onclick="toggleLoginModal()" class="w-full text-gray-500 text-sm hover:text-gray-300">Ø¥Ù„ØºØ§Ø¡</button></form></div></div>
    
    <div id="deleteModal" class="fixed inset-0 z-[200] hidden items-center justify-center bg-black/90 backdrop-blur-sm p-4"><div class="bg-gray-800 border border-red-500/30 w-full max-w-sm rounded-2xl shadow-2xl p-6 text-center"><div class="w-16 h-16 bg-red-900/30 rounded-full flex items-center justify-center mx-auto mb-4"><i class="fas fa-exclamation-triangle text-2xl text-red-500"></i></div><h3 class="text-xl font-bold text-white mb-2">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù</h3><p id="deleteMessage" class="text-gray-400 text-sm mb-6">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ</p><div class="flex gap-3"><button id="confirmDeleteBtn" onclick="executeDelete()" class="flex-1 bg-red-600 hover:bg-red-700 text-white font-bold py-2.5 rounded-xl transition-colors">Ù†Ø¹Ù…ØŒ Ø­Ø°Ù</button><button onclick="closeDeleteModal()" class="flex-1 bg-gray-700 hover:bg-gray-600 text-gray-200 font-bold py-2.5 rounded-xl transition-colors">Ø¥Ù„ØºØ§Ø¡</button></div></div></div>
    
    <div id="bookingOptionsModal" class="fixed inset-0 z-[200] hidden items-center justify-center bg-black/90 backdrop-blur-sm p-4"><div class="bg-gray-800 border border-gray-700 w-full max-w-sm rounded-2xl shadow-2xl p-6 text-center"><h3 class="text-xl font-bold text-white mb-6">ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒØŸ</h3><div class="flex flex-col gap-3"><button onclick="handleInquiry()" class="w-full bg-transparent border border-teal-500 text-teal-400 hover:bg-teal-500/10 font-bold py-3 rounded-xl flex items-center justify-center gap-2"><i class="fab fa-whatsapp text-xl"></i> Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ø§Ù„Ù…Ù†ØªØ¬</button><button onclick="openBookingForm()" class="w-full bg-gradient-to-r from-teal-600 to-blue-600 hover:from-teal-700 text-white font-bold py-3 rounded-xl shadow-lg flex items-center justify-center gap-2"><i class="fas fa-shopping-bag text-xl"></i> Ø£Ø±ÙŠØ¯ Ø§Ù„Ø´Ø±Ø§Ø¡</button></div><button onclick="closeBookingOptions()" class="mt-4 text-gray-500 text-sm hover:text-gray-300">Ø¥ØºÙ„Ø§Ù‚</button></div></div>

    <div id="bookingFormModal" class="fixed inset-0 z-[200] hidden items-center justify-center bg-black/90 backdrop-blur-sm p-4">
        <div class="bg-gray-800 border border-gray-700 w-full max-w-md rounded-2xl shadow-2xl p-4 no-scrollbar">
            <div class="flex justify-between items-center mb-4 border-b border-gray-700 pb-2">
                <h3 class="text-lg font-bold text-white">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨</h3>
                <button onclick="closeBookingForm()" class="text-gray-400 hover:text-white"><i class="fas fa-times"></i></button>
            </div>
            <form onsubmit="finalizeBooking(event)" class="space-y-3">
                <div class="grid grid-cols-2 gap-3">
                    <div><label class="block text-gray-400 text-xs mb-1">Ø§Ù„Ø§Ø³Ù…</label><input type="text" id="clientName" required class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white text-sm"></div>
                    <div><label class="block text-gray-400 text-xs mb-1">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label><input type="tel" id="clientPhone" required class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white text-right text-sm" placeholder="01xxxxxxxxx"></div>
                </div>
                <div><label class="block text-gray-400 text-xs mb-1">Ø§Ù„Ù…Ù†ØªØ¬</label><input type="text" id="formTripTitle" readonly class="w-full bg-gray-900 border border-gray-700 rounded-lg px-3 py-2 text-gray-400 text-sm"></div>
                <div class="grid grid-cols-2 gap-3">
                    <div><label class="block text-gray-400 text-xs mb-1">Ø§Ù„Ø³Ø¹Ø±</label><input type="text" id="formTripPrice" readonly class="w-full bg-gray-900 border border-gray-700 rounded-lg px-3 py-2 text-gray-400 text-center text-sm"></div>
                    <div><label class="block text-gray-400 text-xs mb-1">Ø§Ù„ÙƒÙ…ÙŠØ©</label><input type="number" id="formCount" min="1" value="1" oninput="updateTotalPrice()" required class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white text-center text-sm"></div>
                </div>
                <div class="bg-teal-900/30 border border-teal-500/30 p-3 rounded-lg flex justify-between items-center mt-2">
                    <span class="text-teal-400 font-bold text-sm">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span><span id="formTotal" class="text-white font-black text-lg">0 Ø¬.Ù…</span>
                </div>
                <button type="submit" class="w-full bg-teal-600 hover:bg-teal-700 text-white font-bold py-2.5 rounded-lg shadow-lg mt-2 text-sm">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ <i class="fab fa-whatsapp mr-1"></i></button>
            </form>
        </div>
    </div>

    <div id="notificationModal" class="fixed inset-0 z-[200] hidden items-center justify-center bg-black/80 backdrop-blur-sm p-4">
        <div class="bg-gray-800 border border-teal-500/30 w-full max-w-sm rounded-2xl shadow-2xl p-6">
            <div class="flex justify-between items-center mb-4 border-b border-gray-700 pb-2">
                <h3 class="text-xl font-bold text-white"><i class="fas fa-bell ml-2 text-teal-500"></i> Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h3>
                <button onclick="closeNotificationCenter()" class="text-gray-400 hover:text-white"><i class="fas fa-times"></i></button>
            </div>
            <div id="notificationList" class="max-h-80 overflow-y-auto no-scrollbar"></div>
            <button onclick="closeNotificationCenter()" class="w-full mt-4 text-gray-500 text-sm hover:text-gray-300">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>

    <div id="addTripModal" class="fixed inset-0 z-[100] hidden items-center justify-center bg-black/80 backdrop-blur-sm p-4">
        <div class="bg-gray-800 border border-gray-700 w-full md:max-w-xl rounded-2xl shadow-2xl overflow-hidden flex flex-col max-h-[95vh]">
            <div class="modal-header-fixed p-3 border-b border-gray-700 flex justify-between items-center bg-gray-800 z-20">
                <h3 id="modalTitle" class="text-lg font-bold text-white">Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h3>
                <button onclick="closeTripModal()" class="text-gray-400 hover:text-white"><i class="fas fa-times"></i></button>
            </div>

            <div class="overflow-y-auto flex-grow p-4 space-y-3 no-scrollbar">
                <form id="addTripForm" onsubmit="handleTripSubmit(event)">
                    <div class="grid grid-cols-2 gap-3">
                        <div><label class="block text-xs text-gray-400 mb-1">Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</label><input type="text" id="tripTitle" required class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white text-sm"></div>
                        <div><label class="block text-xs text-gray-400 mb-1">Ø§Ù„Ù‚Ø³Ù…/Ø§Ù„Ù†ÙˆØ¹</label><input type="text" id="tripLocation" required placeholder="Ù…Ø«Ø§Ù„: Ù‡Ø¯Ø§ÙŠØ§ Ø¹ÙŠØ¯ Ù…ÙŠÙ„Ø§Ø¯" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white text-sm"></div>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div><label class="block text-xs text-gray-400 mb-1">Ø§Ù„Ø³Ø¹Ø±</label><input type="number" id="tripPrice" required class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white text-sm"></div>
                        <div><label class="block text-xs text-teal-400 mb-1">ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ø·Ù„Ø¨</label><input type="text" id="tripPhone" required class="w-full bg-gray-700 border border-teal-500/50 rounded-lg px-3 py-2 text-white text-sm ltr"></div>
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <div><label class="block text-xs text-gray-400 mb-1">Ø§Ù„Ø­Ø§Ù„Ø© (Ù†Øµ)</label><input type="text" id="durationText" placeholder="Ù…Ø«Ø§Ù„: Ø¬Ø¯ÙŠØ¯ØŒ Ø¹Ø±Ø¶ Ø®Ø§Øµ" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-2 py-2 text-white text-sm"></div>
                        <div><label class="block text-xs text-gray-400 mb-1">Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªØ§Ø­Ø©</label><input type="number" id="availableSeats" required class="w-full bg-gray-700 border border-gray-600 rounded-lg px-2 py-2 text-white text-sm"></div>
                    </div>
                    <div><label class="block text-xs text-gray-400 mb-1">ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬</label><textarea id="tripDesc" required rows="3" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white text-sm"></textarea></div>
                    <div class="bg-gray-900 p-3 rounded-lg border border-gray-700">
                        <h4 class="text-white text-sm font-bold mb-2"><i class="fas fa-images ml-1"></i> ØµÙˆØ±/ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù…Ù†ØªØ¬</h4>
                        <input type="file" id="tripImageFile" multiple accept="image/*,video/*" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-2 py-1 text-white text-xs ltr">
                    </div>
                </form>
            </div>

            <div class="p-3 bg-gray-800 border-t border-gray-700 z-20">
                <button type="submit" form="addTripForm" id="submitBtn" class="w-full bg-teal-600 hover:bg-teal-700 text-white font-bold py-3 rounded-lg shadow-lg transition-colors">Ø­ÙØ¸ ÙˆÙ†Ø´Ø± Ø§Ù„Ù…Ù†ØªØ¬</button>
            </div>
        </div>
    </div>

    <div id="addBannerModal" class="fixed inset-0 z-[100] hidden items-center justify-center bg-black/80 backdrop-blur-sm p-4">
        <div class="bg-gray-800 border border-gray-700 w-full max-w-lg rounded-2xl shadow-2xl p-6">
            <div class="flex justify-between items-center mb-4 border-b border-gray-700 pb-2"><h3 class="text-lg font-bold text-white">Ø¥Ø¶Ø§ÙØ© ØµÙˆØ± Ø£Ùˆ ÙÙŠØ¯ÙŠÙˆ Ù„Ù„Ø³Ù„Ø§ÙŠØ¯Ø±</h3><button onclick="closeBannerModal()" class="text-gray-400 hover:text-white"><i class="fas fa-times"></i></button></div>
            <form id="addBannerForm" onsubmit="handleBannerSubmit(event)" class="space-y-4"><div class="bg-gray-900 p-4 rounded-xl border border-gray-700"><label class="block text-sm text-gray-400 mb-2">Ø§Ø®ØªØ± ØµÙˆØ±Ø§Ù‹ Ø£Ùˆ ÙÙŠØ¯ÙŠÙˆ</label><input type="file" id="bannerFiles" multiple accept="image/*,video/*" onchange="previewBannerImages(event)" class="w-full text-sm text-gray-400 file:bg-teal-600 file:text-white hover:file:bg-teal-700"></div><div id="bannerPreview" class="flex flex-wrap gap-2 max-h-40 overflow-y-auto no-scrollbar"></div><button type="submit" id="bannerSubmitBtn" class="w-full bg-teal-600 hover:bg-teal-700 text-white font-bold py-3 rounded-lg shadow-lg">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù†Ø´Ø±</button></form>
        </div>
    </div>

</body>
</html>